---
title: "Vagrant + Dockerã®ç’°å¢ƒã§Docker Compose CLIã‚’ä½¿ã†"
emoji: "ğŸ˜€"
type: "tech"
topics: [Mac,Vagrant,Docker,Vagrantfile,docker-compose]
published: false
---
## èƒŒæ™¯

Laravelç­‰ã®PHPã‚¦ã‚§ãƒ–ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã§ã¯[Docker for MacãŒé…ã„å•é¡Œ](https://qiita.com/ucan-lab/items/a88e2e5c2a79f2426163)ãŒã‚ã‚Šã€Vagrantä¸Šã«ç«‹ã¦ãŸDockerã‚³ãƒ³ãƒ†ãƒŠã§é–‹ç™ºã‚’è¡Œã†ã“ã¨ãŒå¤šã„ã€‚

ãã®éš›ã«æœ€è¿‘ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸ[Docker compose CLI](https://github.com/docker/compose-cli)ã‚’ä½¿ã„ãŸã„ã€‚

ãã“ãã“è©°ã¾ã£ãŸ&&ãƒãƒƒãƒˆä¸Šã«ã‚ã¾ã‚Šæƒ…å ±ãŒãªã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ã€‚

## ç’°å¢ƒ

- macOS Catalina
- Virtual box 6.1
- Vagrant 2.2.14
- Ubuntu 20.04 (Vagrantä¸Šã«ç«‹ã¦ã‚‹VM)
- Docker 20.10.8

## å®Ÿè£…

`Vagrant`ãƒ•ã‚¡ã‚¤ãƒ«ã«`docker`ã¨ `docker compose`ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã€‚

```Ruby:Vagrantfile
# -*- mode: ruby -*-
# vi: set ft=ruby :
Vagrant.configure("2") do |config|
    # Sync Directory
    config.vm.synced_folder "/path/to/host/sync/dir", "/home/vagrant/workspace", create:"true", mount_options: ['dmode=777','fmode=777']
    # Mapping ports
    config.vm.network "forwarded_port", guest: 8000, host: 8000
    config.vm.network "forwarded_port", guest: 3306, host: 3306
    config.vm.network "forwarded_port", guest: 8080, host: 8080
    config.vm.network "forwarded_port", guest: 4572, host: 4572
    config.vm.network "private_network", ip: "192.168.33.10"
    # Start ssh agent
    config.vm.provision "shell", run: "always", inline: <<-SHELL
    echo 'eval `ssh-agent`' > /home/vagrant/.bash_profile
  SHELL
  # setup
  config.vm.provision "shell", inline: <<-SHELL
    apt-get -y upgrade
    apt-get -y update
    # docker, docker compose
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    curl -fsSL https://github.com/docker/compose-cli/releases/download/v2.0.0-beta.3/docker-compose-linux-amd64 -o .docker/cli-plugins/docker-compose --create-dirs
    chmod 755 .docker/cli-plugins/docker-compose
    chown -R vagrant:vagrant .docker
    usermod -aG docker vagrant
    gpasswd -a vagrant docker
    systemctl enable --now docker
    systemctl restart docker
    echo 'eval `ssh-agent`' > /home/vagrant/.bash_profile
  SHELL
  config.vm.box = "bento/ubuntu-20.04"
end

```

### è§£èª¬

Shell Scriptã‹ã‚‰`docker`ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â€»æœ¬ç•ªç’°å¢ƒã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨ã¯éæ¨å¥¨ [^1]

```shell
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
```

Docker compose CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â€»ç¾çŠ¶ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„æ¨¡æ§˜ [^2]

```shell
curl -fsSL https://github.com/docker/compose-cli/releases/download/v2.0.0-beta.3/docker-compose-linux-amd64 -o .docker/cli-plugins/docker-compose --create-dirs
chmod 755 .docker/cli-plugins/docker-compose
```

æ¨©é™ã®èª¿æ•´ã¨
`docker`, `docker compose` ã‚³ãƒãƒ³ãƒ‰ã‚’`vagrant`ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

```shell
chmod 755 .docker/cli-plugins/docker-compose
chown -R vagrant:vagrant .docker
usermod -aG docker vagrant
gpasswd -a vagrant docker
```

## çµè¨€

è¨˜äº‹ã¸ã®ã”æŒ‡æ‘˜æ­“è¿

## è£œè¶³

`Vagrant`ãƒ•ã‚¡ã‚¤ãƒ«ã¯[Github](https://github.com/yasuaki640/vagrant-for-docker)ã«ãŠã„ã¦ã‚ã‚Šã¾ã™ã€‚

[^1]: https://docs.docker.com/engine/install/ubuntu/#install-using-the-convenience-script
[^2]: https://github.com/docker/compose-cli/issues/1781

